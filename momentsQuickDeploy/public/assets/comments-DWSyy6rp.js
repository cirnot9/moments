import{h as f,j as l,k as e,q as s,r as $,y as T,t as h,p as i,m as c,G as S,I as _,A as C,s as p,H as V,_ as I,e as N,w as j,F as R,n as B,J as b,K as H,C as z,v as L,o as E,i as P,L as q}from"./index-CbEmHIhb.js";import{s as O,a as F,A as U}from"./time-DaUkeAor.js";import{T as G,A as J,g as K}from"./location-29rgYK3X.js";const Q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},W=f({name:"CommentAltRegular",render:function(g,a){return s(),l("svg",Q,a[0]||(a[0]=[e("path",{d:"M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 7.1 5.8 12 12 12c2.4 0 4.9-.7 7.1-2.4L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64zm16 352c0 8.8-7.2 16-16 16H288l-12.8 9.6L208 428v-60H64c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16h384c8.8 0 16 7.2 16 16v288z",fill:"currentColor"},null,-1)]))}}),X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Y=f({name:"Heart",render:function(g,a){return s(),l("svg",X,a[0]||(a[0]=[e("path",{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z",fill:"currentColor"},null,-1)]))}}),Z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},D=f({name:"HeartRegular",render:function(g,a){return s(),l("svg",Z,a[0]||(a[0]=[e("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3C200.7 23 111.4 15.6 53.6 64.3C-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9c14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7c38.9-32.7 98.9-27.8 136.5 10.5l35 35.7l35-35.7c37.8-38.5 97.8-43.2 136.5-10.6c51.1 43.1 43.5 113.9 7.3 150.8z",fill:"currentColor"},null,-1)]))}}),ee={class:"timeAndAction"},te={key:0,class:"popup"},se=f({__name:"ArticleActions",props:{article:{type:Object,required:!0}},emits:["like","comment"],setup(n,{emit:g}){const a=n,o=$(!1),v=$(!1);function k(){v.value=!v.value}const d=g,t=T(()=>{const m=new Date(a.article.created_at);return isNaN(m.getTime())?0:m.getTime()});return(m,u)=>(s(),l("div",ee,[e("p",{onClick:u[0]||(u[0]=w=>o.value=!o.value)},h(o.value?i(O)(t.value):i(F)(t.value)),1),e("div",{class:"action-wrapper",onClick:k},[u[6]||(u[6]=e("div",{class:"dots-button"},[e("p"),e("p")],-1)),v.value?(s(),l("div",te,[e("div",{class:"popup-item like",onClick:u[1]||(u[1]=w=>d("like"))},[n.article.isLiked?(s(),S(i(_),{key:1,color:"rgb(255,100,100)"},{default:C(()=>[p(i(Y))]),_:1})):(s(),S(i(_),{key:0},{default:C(()=>[p(i(D))]),_:1})),e("span",null,h(n.article.isLiked?"取消喜欢":"喜欢"),1)]),u[5]||(u[5]=e("div",{class:"popup-divider"},null,-1)),e("div",{class:"popup-item comment",onClick:[u[2]||(u[2]=V(w=>d("comment"),["stop"])),u[3]||(u[3]=w=>v.value=!v.value)]},[p(i(_),null,{default:C(()=>[p(i(W))]),_:1}),u[4]||(u[4]=e("span",null,"评论",-1))])])):c("",!0)])]))}}),ne=I(se,[["__scopeId","data-v-7d9384ad"]]),le={class:"container"},oe={key:0,class:"users"},ie={key:0},ae=["src","onClick"],re={key:2},ce={key:0},ue={key:1},de={key:1,class:"input"},me={class:"comments-container"},ve=["onClick"],pe={class:"comment-displayName"},ge={key:0},ke={key:1,class:"comment-displayName"},ye={key:0,class:"input"},he=["placeholder"],we=f({__name:"Review",props:{article:{type:Object,required:!0},isShowInput:Boolean,hasMore:{type:Boolean,required:!0},remainingComments:{type:Number,required:!0},isLoading:{type:Boolean,required:!0},likers:{type:Array,default:()=>[]},comments:{type:Array,default:()=>[]},loadMore:{type:Function,required:!0}},emits:["send-reply"],setup(n,{emit:g}){const a=N(),o=n,v=x=>{const y=x.target;y.style.height="auto",y.style.height=y.scrollHeight+"px"},k=g,d=$(null),t=$(""),m=x=>{d.value===x?d.value=null:(d.value=x,t.value="")},u=()=>{if(!t.value.trim()){a.show("评论内容不能为空","info",2e3);return}k("send-reply",{articleId:o.article.id,parentId:d.value,content:t.value}),t.value="",d.value=null},w=j(),M=T(()=>w.name==="articleDetail");return(x,y)=>(s(),l("div",le,[n.article.like_count!==0?(s(),l("div",oe,[p(i(_),{class:"users-icon"},{default:C(()=>[p(i(D))]),_:1}),(s(!0),l(R,null,B(n.likers,(r,A)=>(s(),l("span",{key:A},[M.value?c("",!0):(s(),l("span",ie,h(r.displayName),1)),M.value?(s(),l("img",{key:1,src:r.avatar,alt:"",style:{width:"25px",height:"25px"},onClick:De=>i(L).push(`/home/${r.username}`)},null,8,ae)):c("",!0),A<n.likers.length-1?(s(),l("span",re,"，")):c("",!0)]))),128)),n.likers.length!==0?(s(),l("span",ce,"...共")):c("",!0),n.article.like_count!==0?(s(),l("span",ue,h(n.article.like_count)+"人喜欢",1)):c("",!0)])):c("",!0),o.isShowInput?(s(),l("div",de,[b(e("textarea",{"onUpdate:modelValue":y[0]||(y[0]=r=>t.value=r),placeholder:"写下你的评论...",onInput:v},null,544),[[H,t.value]]),e("button",{onClick:u},"发送")])):c("",!0),e("div",me,[(s(!0),l(R,null,B(n.comments,r=>(s(),l("div",{class:"comment",key:r.id},[e("div",{onClick:A=>m(r.id)},[e("span",pe,h(r.user.nickname||r.user.username),1),r.parent_id?(s(),l("span",ge," 回复")):c("",!0),r.parent_id?(s(),l("span",ke,h(r.parent_displayName),1)):c("",!0),y[3]||(y[3]=e("span",null,"：",-1)),e("span",null,h(r.content),1)],8,ve),d.value===r.id?(s(),l("div",ye,[b(e("textarea",{"onUpdate:modelValue":y[1]||(y[1]=A=>t.value=A),placeholder:`回复${r.user.nickname||r.user.username}`,onInput:v},null,40,he),[[H,t.value]]),e("button",{onClick:u},"发送")])):c("",!0)]))),128)),n.hasMore?(s(),l("span",{key:0,class:"load-more",onClick:y[2]||(y[2]=(...r)=>n.loadMore&&n.loadMore(...r))},[e("div",null,[z(h(n.remainingComments)+"条回复 ",1),p(i(_),null,{default:C(()=>[p(i(U))]),_:1})])])):c("",!0)])]))}}),_e=I(we,[["__scopeId","data-v-4ecfd637"]]),Ce={class:"container"},fe={key:0},$e=["onClick"],xe=["src"],Ae=["src"],Le=["src"],Ie=f({__name:"Media",props:{article:{type:Object,required:!0}},setup(n){const g=N(),a=$(null),o=m=>{a.value=m},v=()=>{a.value=null},k=$(null),d=()=>g.show("播放视频","info",2e3),t=()=>g.show("暂停视频","info",2e3);return E(()=>{k.value&&(k.value.addEventListener("play",d),k.value.addEventListener("pause",t))}),P(()=>{k.value&&(k.value.removeEventListener("play",d),k.value.removeEventListener("pause",t))}),(m,u)=>(s(),l("div",Ce,[n.article.article_images.length!==0?(s(),l("ul",fe,[(s(!0),l(R,null,B(n.article.article_images,w=>(s(),l("li",{key:w.id,onClick:M=>o(w.image_url)},[e("img",{src:w.image_url,alt:"文章图片"},null,8,xe)],8,$e))),128))])):c("",!0),n.article.article_videos.length!==0&&n.article.article_images.length===0?(s(),l("video",{key:1,src:n.article.article_videos[0]?.video_url,ref_key:"videoRef",ref:k,muted:"",playsinline:"",controls:""},null,8,Ae)):c("",!0),a.value?(s(),l("div",{key:2,class:"overlay",onClick:v},[e("img",{src:a.value,class:"enlarged",alt:"放大图片"},null,8,Le)])):c("",!0)]))}}),Me=I(Ie,[["__scopeId","data-v-6cb979ac"]]),Re={key:0,class:"article-item"},Be=["src"],Ne={class:"article-context"},Se={class:"nickname"},be={class:"tags"},He={class:"media"},Te={class:"review"},qe=f({__name:"ArticleItem",props:{article:{},likers:{},comments:{},isShowInput:{type:Boolean},hasMoreComments:{type:Boolean},remainingComments:{},isLoadingComments:{type:Boolean}},emits:["like","comment","send-reply","load-more-comments"],setup(n,{emit:g}){const a=N(),o=n,v=g;async function k(){try{const t=(await K())?.result;console.log(t)}catch(d){console.log("@error",d)}}return(d,t)=>o.article?(s(),l("div",Re,[e("div",{class:"article-avatar",onClick:t[0]||(t[0]=m=>i(L).push(`/home/${o.article.user.username}`))},[e("img",{src:o.article.user?.avatar,alt:"avatar"},null,8,Be)]),e("div",Ne,[e("div",Se,[e("div",{onClick:t[1]||(t[1]=m=>i(L).push(`/home/${o.article.user.username}`))},[e("p",null,h(o.article.user?.nickname||o.article.user.username),1)]),e("div",be,[o.article.is_top?(s(),l("div",{key:0,class:"tag-item",onClick:t[2]||(t[2]=m=>i(a).show("该内容为置顶内容","info",2e3))},[p(i(_),{class:"tag-icon"},{default:C(()=>[p(i(G))]),_:1}),t[8]||(t[8]=e("span",null,"置顶",-1))])):c("",!0),o.article.is_ad?(s(),l("div",{key:1,class:"tag-item",onClick:t[3]||(t[3]=m=>i(a).show("该内容为广告内容","info",2e3))},[p(i(_),{class:"tag-icon"},{default:C(()=>[p(i(J))]),_:1}),t[9]||(t[9]=e("span",null,"广告",-1))])):c("",!0)])]),d.article.content?(s(),l("div",{key:0,class:"main-context",onClick:t[4]||(t[4]=m=>i(L).push(`/article/${o.article.id}`))},[e("p",null,h(o.article.content),1)])):c("",!0),e("div",He,[p(Me,{article:o.article},null,8,["article"])]),e("div",{class:"location",onClick:k},[e("p",null,h(o.article.location),1)]),p(ne,{article:o.article,onLike:t[5]||(t[5]=m=>v("like",o.article.id)),onComment:t[6]||(t[6]=m=>v("comment"))},null,8,["article"]),e("div",Te,[p(_e,{article:o.article,likers:o.likers,comments:o.comments,"is-show-input":o.isShowInput,"has-more":o.hasMoreComments,"is-loading":o.isLoadingComments,"remaining-comments":o.remainingComments,"load-more":()=>v("load-more-comments"),onSendReply:t[7]||(t[7]=m=>v("send-reply",m))},null,8,["article","likers","comments","is-show-input","has-more","is-loading","remaining-comments","load-more"])])])])):c("",!0)}}),Ee=I(qe,[["__scopeId","data-v-91ea85ef"]]),Pe=n=>q({url:"/comments",method:"post",data:n}),Oe=(n,g)=>q({url:`comments/${n}`,method:"get",params:g});export{Ee as A,Pe as c,Oe as g};
