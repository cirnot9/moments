import{e as S,f as u,q as b,u as I,g as $,h as B,p as N,i as D,c as w,a as m,m as i,n as M,b as C,w as V,I as R,k as h,C as q,o as g,_ as z}from"./index-DC8TisQv.js";import{A as E}from"./ArticleItem-HVwc2niC.js";import{g as L,a as F,b as G,l as _,d as x}from"./articles-kPCKrvUi.js";import{g as O,c as U}from"./comments-CCeL1_DB.js";import{C as j}from"./ChevronLeft-BjDTB2Cn.js";import"./time-Pdvgg59k.js";import"./location-Bpxr3BpU.js";const A=I(),r=$(),H=S("article",()=>{const a=u(null),s=u([]),d=u([]),o=b({article:!1,comment:!1,liker:!1}),p=async e=>{o.article=!0;try{const t=A.token?void 0:L(),l=await F(e,t);a.value=l.data}catch(t){console.error("获取文章内容失败：",t),a.value=null}finally{o.article=!1}},c=async e=>{o.liker=!0;try{const t=await G(e);d.value=t.data}catch(t){console.error(`获取文章 ${e} 的点赞用户列表失败`,t)}finally{o.liker=!1}};return{article:a,comments:s,likers:d,states:o,fetchArticle:p,fetchLikers:c,fetchComments:async e=>{o.comment=!0;try{const t=await O(e,{page:1,pageSize:999});return s.value=t.data.data,!0}catch(t){return console.error("获取评论失败",t),s.value=[],!1}finally{o.comment=!1}},createComment:async e=>{const t=r.show("正在发表评论","loading");try{const l=await U(e);if(l.data){const n=l.data;s.value.push(n),a.value&&a.value.comment_count++}return r.update(t,{type:"success",text:"发表成功",duration:2e3}),!0}catch(l){return console.error("发表评论失败",l),r.update(t,{type:"error",text:"发表失败",duration:2e3}),!1}},toggleLike:async e=>{if(!a.value)return;const t=a.value.isLiked,l=a.value.like_count;t?(a.value.isLiked=!1,a.value.like_count--):(a.value.isLiked=!0,a.value.like_count++);const n=u(1);try{if(A.token)a.value.isLiked?(n.value=r.show("正在点赞","loading"),await _(e),r.update(n.value,{text:"点赞成功",type:"success",duration:2e3})):(n.value=r.show("正在取消点赞","loading"),await x(e),r.update(n.value,{text:"取消点赞成功",type:"success",duration:2e3}));else{const v=L();a.value.isLiked?(n.value=r.show("正在点赞","loading"),await _(e,v),r.update(n.value,{text:"点赞成功",type:"success",duration:2e3})):(n.value=r.show("正在取消点赞","loading"),await x(e,v),r.update(n.value,{text:"取消点赞成功",type:"success",duration:2e3}))}return!0}catch(v){return console.error(`为文章${e}更新点赞状态失败`,v),a.value.isLiked=t,a.value.like_count=l,r.update(n.value,{text:"操作失败",type:"error",duration:2e3}),!1}finally{c(e)}}}}),J={class:"container"},K={class:"header"},P={class:"body"},Q={key:0},T=B({__name:"Detail",setup(a){const s=H(),d=N(),o=Number(d.params.articleId),p=u(!0),c=u(null),f=u(!1);function y(){f.value=!f.value}return D(async()=>{if(o)try{await s.fetchArticle(o),c.value=s.article,await s.fetchLikers(o),await s.fetchComments(o)}catch(k){console.error("Failed to load article details:",k)}finally{p.value=!1}}),(k,e)=>(g(),w("div",J,[m("div",K,[m("div",{id:"back",onClick:e[0]||(e[0]=t=>i(M).back())},[C(i(R),null,{default:V(()=>[C(i(j))]),_:1})]),e[5]||(e[5]=m("div",null,"内容详情",-1)),e[6]||(e[6]=m("div",{class:"func"},null,-1))]),m("div",P,[c.value?h("",!0):(g(),w("span",Q,"正在加载中...")),c.value?(g(),q(E,{key:1,article:c.value,likers:i(s).likers||[],comments:i(s).comments||[],"is-show-input":!!f.value,"has-more-comments":!1,"remaining-comments":0,"is-loading-comments":!1,onLike:e[1]||(e[1]=()=>i(s).toggleLike(i(o))),onComment:e[2]||(e[2]=()=>y()),onSendReply:e[3]||(e[3]=t=>i(s).createComment(t)),onLoadMoreComments:e[4]||(e[4]=()=>console.warn("点击了load-more-comments, 暂时不支持加载更多"))},null,8,["article","likers","comments","is-show-input"])):h("",!0)])]))}}),se=z(T,[["__scopeId","data-v-eb6039ed"]]);export{se as default};
