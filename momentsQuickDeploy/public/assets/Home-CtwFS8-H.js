import{H as V,B as M}from"./Brief-C8N44YP5.js";import{f as N}from"./time-Pdvgg59k.js";import{h as x,c,a as t,o as l,t as h,m as a,k as f,n as w,_ as B,g as D,p as P,f as p,q as L,s as T,i as j,v as q,b as d,w as u,I as y,x as I,d as A,F,l as U,A as E}from"./index-DC8TisQv.js";import{c as O}from"./articles-kPCKrvUi.js";import{C as R}from"./ChevronLeft-BjDTB2Cn.js";import"./UserCircleRegular-BCEMIIOK.js";const G={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},J=x({name:"Cog",render:function(o,m){return l(),c("svg",G,m[0]||(m[0]=[t("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14c-11.1-35.6-30-67.8-54.7-94.6c-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7c-36.7-8.2-74.3-7.8-109.2 0c-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3c-24.7 26.7-43.6 58.9-54.7 94.6c-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14c11.1 35.6 30 67.8 54.7 94.6c3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7c36.7 8.2 74.3 7.8 109.2 0c5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3c24.7-26.7 43.6-58.9 54.7-94.6c1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80s80 35.9 80 80s-35.9 80-80 80z",fill:"currentColor"},null,-1)]))}}),K={class:"article-item"},Q={class:"time"},W={class:"day"},X={class:"month"},Y={class:"content"},Z={key:0,class:"media"},tt={class:"image"},et=["src"],st={class:"text"},at=x({__name:"HomeArticleItem",props:{article:{type:Object,required:!0}},setup(k){const o=k,m=new Date(o.article.created_at).getTime(),v=N(m);return(_,n)=>(l(),c("div",K,[t("div",Q,[t("div",W,h(a(v).data),1),n[1]||(n[1]=t("div",{class:"divider"},"/",-1)),t("div",X,h(a(v).month)+"月",1)]),t("div",Y,[o.article.article_images&&o.article.article_images.length>0?(l(),c("div",Z,[t("div",tt,[t("img",{src:o.article.article_images[0].image_url,alt:"image1"},null,8,et)])])):f("",!0),t("div",{class:"content-text",onClick:n[0]||(n[0]=$=>a(w).push(`/article/${o.article.id}`))},[t("div",st,h(k.article.content),1),n[2]||(n[2]=t("div",null,null,-1))])])]))}}),ot=B(at,[["__scopeId","data-v-d82007dc"]]),nt={class:"container"},rt={class:"top-bar"},it={class:"top-bar-left"},ct={class:"profile"},lt={class:"brief"},dt=["src"],ut={class:"content-container"},mt={class:"content-main"},vt={class:"content-footer"},_t={key:0,class:"status-indicator"},gt={key:2,class:"status-indicator"},pt={key:3,class:"status-indicator"},ft=x({__name:"Home",setup(k){const o=D(),v=P().params.username,_=p(1),n=p(""),$=p(""),z=p(""),H=p(""),g=L([]),r=L({total:0,currentPage:1,pageSize:5,isLoading:!1}),b=T(()=>g.length<r.total),C=async i=>{if(r.isLoading)return;r.isLoading=!0;const e=o.show("正在加载文章","loading");try{const s=await O({page:r.currentPage,pageSize:r.pageSize,userId:i});g.push(...s.data.data),r.total=s.data.total,r.currentPage++,o.update(e,{type:"success",text:"加载成功",duration:2e3})}catch(s){console.error("获取用户文章失败",s),o.update(e,{type:"error",text:"加载失败",duration:2e3})}finally{r.isLoading=!1}};return j(async()=>{try{const i=await q(v);_.value=i.data.id,n.value=i.data.nickname??v,$.value=i.data.avatar??"/img/avatar.jpg",z.value=i.data.header_background??"/img/background.avif",$.value=i.data.avatar,_.value&&await C(_.value),document.title=`${n.value}的主页 - 瞬刻`}catch(i){console.error("获取用户文章失败",i),o.show("加载用户文章失败","error",2e3)}}),(i,e)=>(l(),c("div",nt,[t("div",rt,[d(V,null,{left:u(({isBlurred:s})=>[t("div",it,[d(a(y),{class:I(["icon",{blurred:s}]),onClick:e[0]||(e[0]=S=>a(w).back())},{default:u(()=>[d(a(R))]),_:2},1032,["class"])])]),right:u(({isBlurred:s})=>[t("div",ct,[d(a(y),{class:I(["icon",{blurred:s}]),onClick:e[1]||(e[1]=S=>a(w).push({name:"profile"}))},{default:u(()=>[d(a(J))]),_:2},1032,["class"])])]),_:1})]),t("div",lt,[d(M,null,{"brief-img":u(()=>[t("span",null,h(n.value),1),t("img",{src:$.value,alt:"avatar",onClick:e[2]||(e[2]=s=>a(w).push({name:"profile"}))},null,8,dt)]),"brief-content":u(()=>[A(h(H.value),1)]),_:1})]),t("div",ut,[t("div",mt,[t("ul",null,[(l(!0),c(F,null,U(g,s=>(l(),c("li",{key:s.id},[d(ot,{article:s},null,8,["article"])]))),128))])]),t("div",vt,[r.isLoading?(l(),c("div",_t,"正在加载中...")):f("",!0),b.value&&!r.isLoading?(l(),c("div",{key:1,onClick:e[3]||(e[3]=s=>C(_.value)),class:"status-indicator"},[e[4]||(e[4]=A(" 加载更多 ")),d(a(y),null,{default:u(()=>[d(a(E))]),_:1})])):f("",!0),!b.value&&g.length>0?(l(),c("div",gt,"- 没有更多了 -")):f("",!0),g.length===0?(l(),c("div",pt,"- 该用户还没有发表内容哦 -")):f("",!0)])])]))}}),bt=B(ft,[["__scopeId","data-v-e28ee51a"]]);export{bt as default};
