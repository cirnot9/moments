import{h as g,j as a,k as r,q as i,u as B,e as N,x as A,r as V,N as U,p as o,v as $,s as n,A as u,I as d,J as y,K as k,m as p,B as w,O as L,_ as D}from"./index-CbEmHIhb.js";import{T as M,A as T,g as S}from"./location-29rgYK3X.js";import{C as j}from"./ChevronLeft-DJqv1-Do.js";const F={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 384 512"},P=g({name:"FileWord",render:function(f,s){return i(),a("svg",F,s[0]||(s[0]=[r("path",{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm57.1 120H305c7.7 0 13.4 7.1 11.7 14.7l-38 168c-1.2 5.5-6.1 9.3-11.7 9.3h-38c-5.5 0-10.3-3.8-11.6-9.1c-25.8-103.5-20.8-81.2-25.6-110.5h-.5c-1.1 14.3-2.4 17.4-25.6 110.5c-1.3 5.3-6.1 9.1-11.6 9.1H117c-5.6 0-10.5-3.9-11.7-9.4l-37.8-168c-1.7-7.5 4-14.6 11.7-14.6h24.5c5.7 0 10.7 4 11.8 9.7c15.6 78 20.1 109.5 21 122.2c1.6-10.2 7.3-32.7 29.4-122.7c1.3-5.4 6.1-9.1 11.7-9.1h29.1c5.6 0 10.4 3.8 11.7 9.2c24 100.4 28.8 124 29.6 129.4c-.2-11.2-2.6-17.8 21.6-129.2c1-5.6 5.9-9.5 11.5-9.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z",fill:"currentColor"},null,-1)]))}}),W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},q=g({name:"Image",render:function(f,s){return i(),a("svg",W,s[0]||(s[0]=[r("path",{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56s56-25.072 56-56s-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z",fill:"currentColor"},null,-1)]))}}),E={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 384 512"},J=g({name:"MapMarkerAlt",render:function(f,s){return i(),a("svg",E,s[0]||(s[0]=[r("path",{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192C0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67c-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80s-80 35.817-80 80s35.817 80 80 80z",fill:"currentColor"},null,-1)]))}}),K={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},O=g({name:"Video",render:function(f,s){return i(),a("svg",K,s[0]||(s[0]=[r("path",{d:"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z",fill:"currentColor"},null,-1)]))}}),G={class:"container"},Q={class:"header"},R={id:"back"},X={class:"body"},Y={class:"location"},Z={class:"func"},ee={class:"media-input"},te=g({__name:"Post",setup(x){const f=B(),s=N(),e=A({content:"",status:1,location:"",type:0,isTop:!1,isAd:!1,imageUrls:[],videoUrls:[]}),m=V(""),v=V(""),h=A({location:!1,add:!1});U(m,c=>{const t=c.split(/[\s,]+|[\n]+/).map(l=>l.trim()).filter(l=>l);e.imageUrls=t}),U(v,c=>{const t=c.split(/[\s,]+|[\n]+/).map(l=>l.trim()).filter(l=>l);e.videoUrls=t});function b(){if(e.isTop){e.isTop=!e.isTop,s.show("取消文章置顶","success",2e3);return}e.isTop=!e.isTop,s.show("文章置顶","success",2e3)}function z(){if(e.isAd){e.isAd=!e.isAd,s.show("取消文章为广告","success",2e3);return}e.isAd=!e.isAd,s.show("文章设置为广告","success",2e3)}function _(){e.type=(e.type+1)%3,e.type===0?(m.value="",v.value="",s.show("已切换到文本类型","success",2e3)):e.type===1?(m.value="",v.value="",s.show("已切换到图片类型","success",2e3)):(m.value="",v.value="",s.show("已切换到视频类型","success",2e3))}async function I(){if(h.location){s.show("请勿重复点击","info",2e3);return}const c=s.show("正在获取位置信息","loading");try{h.location=!0;const t=await S();e.location=t?.result.subdivisions+"省 · "+t?.result.city,s.update(c,{type:"success",text:"获取位置信息成功",duration:2e3})}catch(t){console.log(t),s.update(c,{type:"error",text:"获取位置信息失败",duration:2e3})}finally{h.location=!1}}async function H(){if(!e.content&&(!e.imageUrls?.length||e.imageUrls.length===0)&&(!e.videoUrls?.length||e.videoUrls.length===0)){s.show("文章内容不能为空","info",2e3);return}if(h.add){s.show("请勿重复点击","info",2e3);return}const c=s.show("正在发表文章","loading");try{h.add=!0,await L(e),s.update(c,{type:"success",text:"发表成功",duration:2e3})}catch(t){console.log("发表文章失败",t),s.update(c,{type:"error",text:"发表失败",duration:2e3})}finally{e.content="",e.location="",e.imageUrls=[],e.videoUrls=[],m.value="",v.value="",h.add=!1}}const C=c=>{const t=c.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"};return(c,t)=>(i(),a("div",G,[r("div",Q,[r("div",{class:"header-left",onClick:t[0]||(t[0]=l=>o($).back())},[r("div",R,[n(o(d),null,{default:u(()=>[n(o(j))]),_:1})]),t[7]||(t[7]=r("div",null,"发表文章",-1))]),r("div",{class:"header-right"},[r("button",{onClick:H},"发表")])]),r("div",X,[y(r("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>e.content=l),placeholder:"这一刻的想法...",onInput:C,class:"contentArea"},null,544),[[k,e.content]]),r("div",Y,[r("div",null,[n(o(d),{onClick:I},{default:u(()=>[n(o(J))]),_:1}),y(r("input",{type:"text",placeholder:"输入位置信息","onUpdate:modelValue":t[2]||(t[2]=l=>e.location=l)},null,512),[[k,e.location]])])]),r("div",Z,[Number(o(f).profile?.role)===1?(i(),a("span",{key:0,class:w(["func-item",{true:e.isTop}]),onClick:b},[n(o(d),null,{default:u(()=>[n(o(M))]),_:1})],2)):p("",!0),Number(o(f).profile?.role)===1?(i(),a("span",{key:1,class:w(["func-item",{true:e.isAd}]),onClick:z},[n(o(d),null,{default:u(()=>[n(o(T))]),_:1})],2)):p("",!0),Number(o(f).profile?.role)!==1?(i(),a("span",{key:2,class:w(["func-item",{true:e.isTop}]),onClick:t[3]||(t[3]=l=>o(s).show("权限不足","info",2e3))},[n(o(d),null,{default:u(()=>[n(o(M))]),_:1})],2)):p("",!0),Number(o(f).profile?.role)!==1?(i(),a("span",{key:3,class:w(["func-item",{true:e.isAd}]),onClick:t[4]||(t[4]=l=>o(s).show("权限不足","info",2e3))},[n(o(d),null,{default:u(()=>[n(o(T))]),_:1})],2)):p("",!0),e.type===0?(i(),a("span",{key:4,class:w(["func-item",{true:e.type===0}]),onClick:_},[n(o(d),null,{default:u(()=>[n(o(P))]),_:1})],2)):p("",!0),e.type===1?(i(),a("span",{key:5,class:w(["func-item",{true:e.type===1}]),onClick:_},[n(o(d),null,{default:u(()=>[n(o(q))]),_:1})],2)):p("",!0),e.type===2?(i(),a("span",{key:6,class:w(["func-item",{true:e.type===2}]),onClick:_},[n(o(d),null,{default:u(()=>[n(o(O))]),_:1})],2)):p("",!0)]),r("div",ee,[e.type===1?y((i(),a("textarea",{key:0,"onUpdate:modelValue":t[5]||(t[5]=l=>m.value=l),placeholder:" 输入图片链接(使用“,”、空格、换行 区分图片)",onInput:C,class:"imageArea"},null,544)),[[k,m.value]]):p("",!0),e.type===2?y((i(),a("textarea",{key:1,"onUpdate:modelValue":t[6]||(t[6]=l=>v.value=l),placeholder:" 输入视频链接",onInput:C,class:"imageArea"},null,544)),[[k,v.value]]):p("",!0)])])]))}}),ne=D(te,[["__scopeId","data-v-00991b7e"]]);export{ne as default};
