import{d as S,r as u,x as b,u as I,g as w,a as $,b as B,e as N,l as C,f as h,h as D,w as M,o as V,j as L,k as m,p as i,v as G,s as _,A as R,I as j,m as x,G as q,q as g,_ as z}from"./index-CbEmHIhb.js";import{g as E,c as F,A as O}from"./comments-DWSyy6rp.js";import{C as U}from"./ChevronLeft-DJqv1-Do.js";import"./time-DaUkeAor.js";import"./location-29rgYK3X.js";const A=I(),r=N(),H=S("article",()=>{const s=u(null),a=u([]),d=u([]),o=b({article:!1,comment:!1,liker:!1}),k=async e=>{o.article=!0;try{const t=A.token?void 0:w(),l=await $(e,t);s.value=l.data}catch(t){console.error("获取文章内容失败：",t),s.value=null}finally{o.article=!1}},c=async e=>{o.liker=!0;try{const t=await B(e);d.value=t.data}catch(t){console.error(`获取文章 ${e} 的点赞用户列表失败`,t)}finally{o.liker=!1}};return{article:s,comments:a,likers:d,states:o,fetchArticle:k,fetchLikers:c,fetchComments:async e=>{o.comment=!0;try{const t=await E(e,{page:1,pageSize:999});return a.value=t.data.data,!0}catch(t){return console.error("获取评论失败",t),a.value=[],!1}finally{o.comment=!1}},createComment:async e=>{const t=r.show("正在发表评论","loading");try{const l=await F(e);if(l.data){const n=l.data;a.value.push(n),s.value&&s.value.comment_count++}return r.update(t,{type:"success",text:"发表成功",duration:2e3}),!0}catch(l){return console.error("发表评论失败",l),r.update(t,{type:"error",text:"发表失败",duration:2e3}),!1}},toggleLike:async e=>{if(!s.value)return;const t=s.value.isLiked,l=s.value.like_count;t?(s.value.isLiked=!1,s.value.like_count--):(s.value.isLiked=!0,s.value.like_count++);const n=u(1);try{if(A.token)s.value.isLiked?(n.value=r.show("正在点赞","loading"),await C(e),r.update(n.value,{text:"点赞成功",type:"success",duration:2e3})):(n.value=r.show("正在取消点赞","loading"),await h(e),r.update(n.value,{text:"取消点赞成功",type:"success",duration:2e3}));else{const v=w();s.value.isLiked?(n.value=r.show("正在点赞","loading"),await C(e,v),r.update(n.value,{text:"点赞成功",type:"success",duration:2e3})):(n.value=r.show("正在取消点赞","loading"),await h(e,v),r.update(n.value,{text:"取消点赞成功",type:"success",duration:2e3}))}return!0}catch(v){return console.error(`为文章${e}更新点赞状态失败`,v),s.value.isLiked=t,s.value.like_count=l,r.update(n.value,{text:"操作失败",type:"error",duration:2e3}),!1}finally{c(e)}}}}),J={class:"container"},K={class:"header"},P={class:"body"},Q={key:0},T=D({__name:"Detail",setup(s){const a=H(),d=M(),o=Number(d.params.articleId),k=u(!0),c=u(null),f=u(!1);function y(){f.value=!f.value}return V(async()=>{if(o)try{await a.fetchArticle(o),c.value=a.article,await a.fetchLikers(o),await a.fetchComments(o)}catch(p){console.error("Failed to load article details:",p)}finally{k.value=!1}}),(p,e)=>(g(),L("div",J,[m("div",K,[m("div",{id:"back",onClick:e[0]||(e[0]=t=>i(G).back())},[_(i(j),null,{default:R(()=>[_(i(U))]),_:1})]),e[5]||(e[5]=m("div",null,"内容详情",-1)),e[6]||(e[6]=m("div",{class:"func"},null,-1))]),m("div",P,[c.value?x("",!0):(g(),L("span",Q,"正在加载中...")),c.value?(g(),q(O,{key:1,article:c.value,likers:i(a).likers||[],comments:i(a).comments||[],"is-show-input":!!f.value,"has-more-comments":!1,"remaining-comments":0,"is-loading-comments":!1,onLike:e[1]||(e[1]=()=>i(a).toggleLike(i(o))),onComment:e[2]||(e[2]=()=>y()),onSendReply:e[3]||(e[3]=t=>i(a).createComment(t)),onLoadMoreComments:e[4]||(e[4]=()=>console.warn("点击了load-more-comments, 暂时不支持加载更多"))},null,8,["article","likers","comments","is-show-input"])):x("",!0)])]))}}),te=z(T,[["__scopeId","data-v-eb6039ed"]]);export{te as default};
